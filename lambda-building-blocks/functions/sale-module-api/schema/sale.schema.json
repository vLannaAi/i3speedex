{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://i2speedex.com/schemas/sale.json",
  "title": "Sale",
  "description": "Sale (Venda) entity schema for DynamoDB",
  "type": "object",
  "required": [
    "PK",
    "SK",
    "EntityType",
    "SaleId",
    "BuyerId",
    "BuyerName",
    "ProducerId",
    "ProducerName",
    "SaleDate",
    "Status",
    "Total"
  ],
  "properties": {
    "PK": {
      "type": "string",
      "pattern": "^SALE#[A-Z0-9]+$",
      "description": "Partition key: SALE#{sale_id}"
    },
    "SK": {
      "type": "string",
      "const": "#METADATA#sale",
      "description": "Sort key for sale metadata"
    },
    "EntityType": {
      "type": "string",
      "const": "Sale"
    },
    "SaleId": {
      "type": "string",
      "pattern": "^SALE[0-9]{3,}$",
      "description": "Unique sale identifier"
    },
    "BuyerId": {
      "type": "string",
      "pattern": "^BUYER[0-9]{3,}$"
    },
    "BuyerName": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200
    },
    "BuyerDocument": {
      "type": "string",
      "description": "CNPJ or CPF"
    },
    "ProducerId": {
      "type": "string",
      "pattern": "^PRODUCER[0-9]{3,}$"
    },
    "ProducerName": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200
    },
    "ProducerDocument": {
      "type": "string",
      "description": "CNPJ or CPF"
    },
    "SaleDate": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp"
    },
    "DeliveryDate": {
      "type": "string",
      "format": "date-time"
    },
    "InvoiceDate": {
      "type": "string",
      "format": "date-time"
    },
    "Status": {
      "type": "string",
      "enum": [
        "DRAFT",
        "CONFIRMED",
        "INVOICED",
        "SHIPPED",
        "DELIVERED",
        "CANCELLED"
      ]
    },
    "PaymentTerms": {
      "type": "string",
      "enum": [
        "CASH",
        "15_DAYS",
        "30_DAYS",
        "45_DAYS",
        "60_DAYS",
        "90_DAYS"
      ]
    },
    "Quantity": {
      "type": "number",
      "minimum": 0
    },
    "UnitPrice": {
      "type": "number",
      "minimum": 0
    },
    "Subtotal": {
      "type": "number",
      "minimum": 0
    },
    "Discount": {
      "type": "number",
      "minimum": 0
    },
    "Tax": {
      "type": "number",
      "minimum": 0
    },
    "Total": {
      "type": "number",
      "minimum": 0
    },
    "Currency": {
      "type": "string",
      "enum": ["BRL", "USD", "EUR"],
      "default": "BRL"
    },
    "Notes": {
      "type": "string",
      "maxLength": 1000
    },
    "InvoiceNumber": {
      "type": "string"
    },
    "InvoiceKey": {
      "type": "string",
      "pattern": "^[0-9]{44}$",
      "description": "NFe key (44 digits)"
    },
    "InvoiceFileUrl": {
      "type": "string",
      "format": "uri"
    },
    "CreatedAt": {
      "type": "string",
      "format": "date-time"
    },
    "CreatedBy": {
      "type": "string",
      "format": "email"
    },
    "UpdatedAt": {
      "type": "string",
      "format": "date-time"
    },
    "UpdatedBy": {
      "type": "string",
      "format": "email"
    },
    "GSI1PK": {
      "type": "string",
      "pattern": "^BUYER#[A-Z0-9]+$"
    },
    "GSI1SK": {
      "type": "string",
      "pattern": "^SALE#[0-9]{4}-[0-9]{2}-[0-9]{2}T"
    },
    "GSI2PK": {
      "type": "string",
      "pattern": "^PRODUCER#[A-Z0-9]+$"
    },
    "GSI2SK": {
      "type": "string",
      "pattern": "^SALE#[0-9]{4}-[0-9]{2}-[0-9]{2}T"
    },
    "GSI3PK": {
      "type": "string",
      "pattern": "^STATUS#"
    },
    "GSI3SK": {
      "type": "string",
      "pattern": "^SALE#[0-9]{4}-[0-9]{2}-[0-9]{2}T"
    }
  },
  "additionalProperties": false
}
